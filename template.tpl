___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "FormHQ Project Tag",
  "categories": ["ANALYTICS", "UTILITY"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "FormHQ by WebMechanix",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Injects the FormHQ project tag and allows for easy configuration.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "projectId",
    "displayName": "Project ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "REGEX",
        "args": [
          "[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}"
        ]
      }
    ],
    "help": "You can get this by logging into your FormHQ, visiting your project dashboard, and clicking the \"Project Tag\" button.",
    "valueHint": "e.g. xxxxyyyy-zzzz-aaaa-bbbb-ccccddddeeee",
    "alwaysInSummary": false
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "platforms",
    "displayName": "Platforms",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Key",
        "name": "key",
        "type": "TEXT",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          },
          {
            "type": "REGEX",
            "args": [
              "[a-z]+"
            ]
          }
        ],
        "isUnique": true,
        "valueHint": "e.g: hubspot"
      },
      {
        "defaultValue": "",
        "displayName": "Native ID",
        "name": "id",
        "type": "TEXT",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "valueHint": "e.g: 123456"
      }
    ],
    "newRowButtonText": "Add configuration",
    "help": "If your project tag has values inside the platforms configuration object, you need to define them here.",
    "alwaysInSummary": false
  },
  {
    "type": "GROUP",
    "name": "overrides",
    "displayName": "Default Config Overrides",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "configFields",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Field",
            "name": "key",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "redirectDelay",
                "displayValue": "redirectDelay"
              },
              {
                "value": "dataLayer",
                "displayValue": "dataLayer"
              },
              {
                "value": "gtmEventName",
                "displayValue": "gtmEventName"
              },
              {
                "value": "categoryParam",
                "displayValue": "categoryParam"
              },
              {
                "value": "actionParam",
                "displayValue": "actionParam"
              },
              {
                "value": "labelParam",
                "displayValue": "labelParam"
              },
              {
                "value": "valueParam",
                "displayValue": "valueParam"
              },
              {
                "value": "payloadFilter",
                "displayValue": "payloadFilter"
              },
              {
                "value": "notFound",
                "displayValue": "notFound"
              },
              {
                "value": "noGroup",
                "displayValue": "noGroup"
              },
              {
                "value": "eventCategory",
                "displayValue": "eventCategory"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY",
                "enablingConditions": []
              }
            ]
          }
        ]
      }
    ],
    "help": "Visit the \u003ca href\u003d\"#\" target\u003d\"_blank\"\u003eFormHQ Knowledge Base\u003c/a\u003e for information about configuration options."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const setInWindow = require('setInWindow');
const injectScript = require('injectScript');
const makeTableMap = require('makeTableMap');

const namespace = 'FormHQ';
let config = {};

if (data.configFields)
  config = makeTableMap(data.configFields, 'key', 'value');

if (data.platforms)
  config.platforms = makeTableMap(data.platforms, 'key', 'id');

config.id = data.projectId;

setInWindow(namespace, config, false);

injectScript('https://embed.formhq.net/v1/base.js', data.gtmOnSuccess, data.gtmOnFailure, namespace);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.formhq.net/v*/base.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "FormHQ"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 7/26/2021, 5:46:49 AM


